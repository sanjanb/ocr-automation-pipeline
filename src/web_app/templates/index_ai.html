<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>AI-Powered OCR Pipeline | MIT Hackathon</title>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\" rel=\"stylesheet\">\n    <style>\n        .gradient-bg {\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n        }\n        \n        .ai-badge {\n            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);\n            color: white;\n            font-weight: bold;\n            border: none;\n        }\n        \n        .method-card {\n            transition: transform 0.2s, box-shadow 0.2s;\n            cursor: pointer;\n            border: 2px solid transparent;\n        }\n        \n        .method-card:hover {\n            transform: translateY(-5px);\n            box-shadow: 0 8px 25px rgba(0,0,0,0.1);\n        }\n        \n        .method-card.selected {\n            border-color: #667eea;\n            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);\n        }\n        \n        .upload-area {\n            border: 3px dashed #ddd;\n            border-radius: 15px;\n            padding: 40px;\n            text-align: center;\n            transition: all 0.3s;\n            background: #fafafa;\n        }\n        \n        .upload-area.dragover {\n            border-color: #667eea;\n            background: rgba(102, 126, 234, 0.1);\n        }\n        \n        .result-card {\n            border-left: 4px solid #667eea;\n        }\n        \n        .entity-item {\n            background: rgba(102, 126, 234, 0.1);\n            border-radius: 8px;\n            padding: 8px 12px;\n            margin: 4px;\n            display: inline-block;\n        }\n        \n        .confidence-bar {\n            height: 8px;\n            border-radius: 4px;\n            background: #e9ecef;\n            overflow: hidden;\n        }\n        \n        .confidence-fill {\n            height: 100%;\n            transition: width 0.3s;\n        }\n        \n        .status-icon {\n            font-size: 2rem;\n        }\n        \n        .loading {\n            opacity: 0.7;\n        }\n    </style>\n</head>\n<body>\n    <!-- Header -->\n    <header class=\"gradient-bg py-4\">\n        <div class=\"container\">\n            <div class=\"row align-items-center\">\n                <div class=\"col-md-8\">\n                    <h1 class=\"mb-0\">\n                        <i class=\"fas fa-robot me-3\"></i>\n                        AI-Powered OCR Pipeline\n                    </h1>\n                    <p class=\"mb-0 mt-2 opacity-75\">MIT Hackathon Project - Document Understanding with AI</p>\n                </div>\n                <div class=\"col-md-4 text-end\">\n                    {% if ai_enabled %}\n                        <span class=\"badge ai-badge px-3 py-2\">\n                            <i class=\"fas fa-brain me-2\"></i>AI Enabled\n                        </span>\n                    {% else %}\n                        <span class=\"badge bg-warning px-3 py-2\">\n                            <i class=\"fas fa-exclamation-triangle me-2\"></i>AI Disabled\n                        </span>\n                    {% endif %}\n                </div>\n            </div>\n        </div>\n    </header>\n\n    <div class=\"container my-5\">\n        <!-- Method Selection -->\n        <div class=\"row mb-4\">\n            <div class=\"col-12\">\n                <h2 class=\"mb-3\">\n                    <i class=\"fas fa-cogs me-2\"></i>\n                    Choose Extraction Method\n                </h2>\n                <div class=\"row\" id=\"methodSelection\">\n                    <div class=\"col-md-4\">\n                        <div class=\"card method-card h-100\" data-method=\"auto\">\n                            <div class=\"card-body text-center\">\n                                <div class=\"status-icon text-primary mb-3\">\n                                    <i class=\"fas fa-magic\"></i>\n                                </div>\n                                <h5 class=\"card-title\">Auto (Recommended)</h5>\n                                <p class=\"card-text\">Uses AI models with traditional OCR as fallback for maximum accuracy.</p>\n                                <div class=\"mt-3\">\n                                    <span class=\"badge bg-primary\">Hybrid</span>\n                                    <span class=\"badge bg-success\">Best Results</span>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <div class=\"col-md-4\">\n                        <div class=\"card method-card h-100\" data-method=\"ai\">\n                            <div class=\"card-body text-center\">\n                                <div class=\"status-icon text-info mb-3\">\n                                    <i class=\"fas fa-brain\"></i>\n                                </div>\n                                <h5 class=\"card-title\">AI-Powered</h5>\n                                <p class=\"card-text\">Uses Hugging Face models (Donut, LayoutLM) for document understanding.</p>\n                                <div class=\"mt-3\">\n                                    <span class=\"badge bg-info\">Advanced</span>\n                                    {% if not hf_token_set %}\n                                        <span class=\"badge bg-warning\">Token Required</span>\n                                    {% endif %}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <div class=\"col-md-4\">\n                        <div class=\"card method-card h-100\" data-method=\"traditional\">\n                            <div class=\"card-body text-center\">\n                                <div class=\"status-icon text-secondary mb-3\">\n                                    <i class=\"fas fa-eye\"></i>\n                                </div>\n                                <h5 class=\"card-title\">Traditional OCR</h5>\n                                <p class=\"card-text\">Uses OCR engines with regex pattern matching. Fast and reliable.</p>\n                                <div class=\"mt-3\">\n                                    <span class=\"badge bg-secondary\">Classic</span>\n                                    <span class=\"badge bg-success\">Fast</span>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Upload Section -->\n        <div class=\"row mb-4\">\n            <div class=\"col-12\">\n                <h2 class=\"mb-3\">\n                    <i class=\"fas fa-upload me-2\"></i>\n                    Upload Document\n                </h2>\n                <div class=\"upload-area\" id=\"uploadArea\">\n                    <form id=\"uploadForm\" enctype=\"multipart/form-data\">\n                        <div class=\"mb-3\">\n                            <i class=\"fas fa-cloud-upload-alt fa-3x text-muted mb-3\"></i>\n                            <h4>Drop your document here or click to browse</h4>\n                            <p class=\"text-muted\">\n                                Supports: JPG, PNG, WEBP, PDF | Max size: 10MB\n                            </p>\n                            <input type=\"file\" class=\"form-control d-none\" id=\"fileInput\" \n                                   accept=\".jpg,.jpeg,.png,.bmp,.tiff,.webp,.pdf\">\n                            <input type=\"hidden\" id=\"methodInput\" name=\"method\" value=\"auto\">\n                        </div>\n                        \n                        <div class=\"row\">\n                            <div class=\"col-md-6 mx-auto\">\n                                <label for=\"docTypeHint\" class=\"form-label\">Document Type Hint (Optional)</label>\n                                <select class=\"form-select\" id=\"docTypeHint\" name=\"document_type_hint\">\n                                    <option value=\"\">Auto-detect</option>\n                                    <option value=\"marksheet_12th\">12th Marksheet</option>\n                                    <option value=\"marksheet_10th\">10th Marksheet</option>\n                                    <option value=\"entrance_scorecard\">Entrance Exam Scorecard</option>\n                                    <option value=\"caste_certificate\">Caste Certificate</option>\n                                </select>\n                            </div>\n                        </div>\n                        \n                        <button type=\"submit\" class=\"btn btn-primary btn-lg mt-3\" id=\"uploadBtn\">\n                            <i class=\"fas fa-magic me-2\"></i>\n                            Process Document\n                        </button>\n                    </form>\n                </div>\n            </div>\n        </div>\n\n        <!-- Results Section -->\n        <div class=\"row\" id=\"resultsSection\" style=\"display: none;\">\n            <div class=\"col-12\">\n                <h2 class=\"mb-3\">\n                    <i class=\"fas fa-chart-line me-2\"></i>\n                    Extraction Results\n                </h2>\n                <div class=\"card result-card\">\n                    <div class=\"card-header\">\n                        <div class=\"row align-items-center\">\n                            <div class=\"col-md-8\">\n                                <h5 class=\"mb-0\" id=\"resultTitle\">Processing...</h5>\n                                <small class=\"text-muted\" id=\"resultSubtitle\">Please wait...</small>\n                            </div>\n                            <div class=\"col-md-4 text-end\">\n                                <span class=\"badge bg-primary\" id=\"resultBadge\">Processing</span>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"card-body\">\n                        <div class=\"row mb-3\">\n                            <div class=\"col-md-6\">\n                                <label class=\"form-label fw-bold\">Confidence Score</label>\n                                <div class=\"confidence-bar\">\n                                    <div class=\"confidence-fill\" id=\"confidenceBar\" style=\"width: 0%\"></div>\n                                </div>\n                                <small class=\"text-muted\" id=\"confidenceText\">0%</small>\n                            </div>\n                            <div class=\"col-md-3\">\n                                <label class=\"form-label fw-bold\">Processing Time</label>\n                                <div id=\"processingTime\">-</div>\n                            </div>\n                            <div class=\"col-md-3\">\n                                <label class=\"form-label fw-bold\">Method Used</label>\n                                <div id=\"methodUsed\">-</div>\n                            </div>\n                        </div>\n\n                        <div class=\"row\">\n                            <div class=\"col-md-6\">\n                                <h6 class=\"fw-bold mb-3\">\n                                    <i class=\"fas fa-tags me-2\"></i>\n                                    Extracted Information\n                                </h6>\n                                <div id=\"extractedEntities\">No entities extracted yet...</div>\n                            </div>\n                            \n                            <div class=\"col-md-6\">\n                                <h6 class=\"fw-bold mb-3\">\n                                    <i class=\"fas fa-file-text me-2\"></i>\n                                    Raw Text Preview\n                                </h6>\n                                <div class=\"border rounded p-3\" style=\"max-height: 300px; overflow-y: auto;\">\n                                    <pre id=\"extractedText\" class=\"mb-0 small text-muted\">No text extracted yet...</pre>\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <div class=\"row mt-3\" id=\"errorSection\" style=\"display: none;\">\n                            <div class=\"col-12\">\n                                <div class=\"alert alert-danger\">\n                                    <i class=\"fas fa-exclamation-triangle me-2\"></i>\n                                    <strong>Error:</strong> <span id=\"errorMessage\"></span>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        <!-- AI Token Warning -->\n        {% if not hf_token_set %}\n        <div class=\"row mt-4\">\n            <div class=\"col-12\">\n                <div class=\"alert alert-warning\">\n                    <h5><i class=\"fas fa-info-circle me-2\"></i>AI Features Available</h5>\n                    <p class=\"mb-2\">\n                        To use AI-powered extraction, set your Hugging Face API token:\n                    </p>\n                    <ol class=\"mb-2\">\n                        <li>Get a free token from <a href=\"https://huggingface.co/settings/tokens\" target=\"_blank\">Hugging Face</a></li>\n                        <li>Set environment variable: <code>HUGGING_FACE_TOKEN=your_token_here</code></li>\n                        <li>Restart the application</li>\n                    </ol>\n                    <p class=\"mb-0\">Without a token, you can still use traditional OCR extraction.</p>\n                </div>\n            </div>\n        </div>\n        {% endif %}\n    </div>\n\n    <!-- Footer -->\n    <footer class=\"gradient-bg text-center py-4 mt-5\">\n        <div class=\"container\">\n            <p class=\"mb-0\">MIT Hackathon 2024 | AI-Powered Document Processing Pipeline</p>\n        </div>\n    </footer>\n\n    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>\n    <script>\n        let selectedMethod = 'auto';\n        \n        // Method selection\n        document.querySelectorAll('.method-card').forEach(card => {\n            card.addEventListener('click', function() {\n                document.querySelectorAll('.method-card').forEach(c => c.classList.remove('selected'));\n                this.classList.add('selected');\n                selectedMethod = this.dataset.method;\n                document.getElementById('methodInput').value = selectedMethod;\n                \n                // Update upload button text\n                const btn = document.getElementById('uploadBtn');\n                const methodNames = {\n                    'auto': 'Process with Auto Detection',\n                    'ai': 'Process with AI Models', \n                    'traditional': 'Process with Traditional OCR'\n                };\n                btn.innerHTML = `<i class=\"fas fa-magic me-2\"></i>${methodNames[selectedMethod]}`;\n            });\n        });\n        \n        // Select default method\n        document.querySelector('[data-method=\"auto\"]').click();\n        \n        // File upload handling\n        const uploadArea = document.getElementById('uploadArea');\n        const fileInput = document.getElementById('fileInput');\n        const uploadForm = document.getElementById('uploadForm');\n        \n        uploadArea.addEventListener('click', () => fileInput.click());\n        \n        uploadArea.addEventListener('dragover', (e) => {\n            e.preventDefault();\n            uploadArea.classList.add('dragover');\n        });\n        \n        uploadArea.addEventListener('dragleave', () => {\n            uploadArea.classList.remove('dragover');\n        });\n        \n        uploadArea.addEventListener('drop', (e) => {\n            e.preventDefault();\n            uploadArea.classList.remove('dragover');\n            const files = e.dataTransfer.files;\n            if (files.length > 0) {\n                fileInput.files = files;\n                processFile();\n            }\n        });\n        \n        fileInput.addEventListener('change', processFile);\n        \n        uploadForm.addEventListener('submit', (e) => {\n            e.preventDefault();\n            if (fileInput.files.length > 0) {\n                processFile();\n            }\n        });\n        \n        async function processFile() {\n            const file = fileInput.files[0];\n            if (!file) return;\n            \n            // Show results section\n            document.getElementById('resultsSection').style.display = 'block';\n            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });\n            \n            // Reset UI\n            resetResults();\n            showLoading();\n            \n            try {\n                const formData = new FormData(uploadForm);\n                formData.append('file', file);\n                \n                const response = await fetch('/upload-and-process', {\n                    method: 'POST',\n                    body: formData\n                });\n                \n                const result = await response.json();\n                \n                if (response.ok && result.success) {\n                    displayResults(result);\n                } else {\n                    displayError(result.error || 'Processing failed');\n                }\n            } catch (error) {\n                displayError('Network error: ' + error.message);\n            }\n        }\n        \n        function resetResults() {\n            document.getElementById('errorSection').style.display = 'none';\n            document.getElementById('confidenceBar').style.width = '0%';\n            document.getElementById('confidenceText').textContent = '0%';\n        }\n        \n        function showLoading() {\n            document.getElementById('resultTitle').textContent = 'Processing Document...';\n            document.getElementById('resultSubtitle').textContent = `Using ${selectedMethod} method`;\n            document.getElementById('resultBadge').textContent = 'Processing';\n            document.getElementById('resultBadge').className = 'badge bg-warning';\n            document.getElementById('extractedEntities').innerHTML = '<div class=\"spinner-border spinner-border-sm me-2\"></div>Processing...';\n            document.getElementById('extractedText').textContent = 'Processing...';\n        }\n        \n        function displayResults(result) {\n            // Update header\n            document.getElementById('resultTitle').textContent = result.filename;\n            document.getElementById('resultSubtitle').textContent = `Document Type: ${result.document_type}`;\n            document.getElementById('resultBadge').textContent = 'Success';\n            document.getElementById('resultBadge').className = 'badge bg-success';\n            \n            // Update metrics\n            const confidence = Math.round(result.confidence * 100);\n            document.getElementById('confidenceBar').style.width = confidence + '%';\n            document.getElementById('confidenceBar').style.background = \n                confidence > 80 ? '#28a745' : confidence > 60 ? '#ffc107' : '#dc3545';\n            document.getElementById('confidenceText').textContent = confidence + '%';\n            document.getElementById('processingTime').textContent = result.processing_time.toFixed(2) + 's';\n            document.getElementById('methodUsed').textContent = result.method_used;\n            \n            // Display entities\n            displayEntities(result.entities);\n            \n            // Display text\n            document.getElementById('extractedText').textContent = result.extracted_text || 'No text available';\n        }\n        \n        function displayEntities(entities) {\n            const container = document.getElementById('extractedEntities');\n            \n            if (!entities || Object.keys(entities).length === 0) {\n                container.innerHTML = '<em class=\"text-muted\">No structured data extracted</em>';\n                return;\n            }\n            \n            let html = '';\n            for (const [key, value] of Object.entries(entities)) {\n                if (typeof value === 'object' && value !== null) {\n                    html += `<div class=\"mb-2\"><strong>${formatKey(key)}:</strong></div>`;\n                    for (const [subKey, subValue] of Object.entries(value)) {\n                        html += `<div class=\"entity-item ms-3\">${formatKey(subKey)}: ${subValue}</div>`;\n                    }\n                } else {\n                    html += `<div class=\"entity-item\"><strong>${formatKey(key)}:</strong> ${value}</div>`;\n                }\n            }\n            \n            container.innerHTML = html;\n        }\n        \n        function formatKey(key) {\n            return key.replace(/_/g, ' ')\n                     .split(' ')\n                     .map(word => word.charAt(0).toUpperCase() + word.slice(1))\n                     .join(' ');\n        }\n        \n        function displayError(errorMessage) {\n            document.getElementById('resultTitle').textContent = 'Processing Failed';\n            document.getElementById('resultBadge').textContent = 'Error';\n            document.getElementById('resultBadge').className = 'badge bg-danger';\n            document.getElementById('errorSection').style.display = 'block';\n            document.getElementById('errorMessage').textContent = errorMessage;\n            document.getElementById('extractedEntities').innerHTML = '<em class=\"text-muted\">Processing failed</em>';\n        }\n    </script>\n</body>\n</html>